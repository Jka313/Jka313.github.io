<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JKA5 | OS v7.0 (ARCHITECT)</title>
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;700&family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --bg: #050505;
            --win-bg: rgba(12, 12, 12, 0.96);
            --main-neon: #00ff41; 
            --neon-cyan: #00f3ff;
            --alert: #ff003c;
            --font-code: 'Fira Code', monospace;
            --font-text: 'Cairo', monospace;
        }

        * { box-sizing: border-box; user-select: none; outline: none; }
        body { margin: 0; overflow: hidden; background: var(--bg); font-family: var(--font-code); color: var(--main-neon); transition: color 0.5s; }
        
        .scanlines { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06)); background-size: 100% 2px, 3px 100%; pointer-events: none; z-index: 9999; opacity: 0.15; }

        /* Desktop Backgrounds */
        #desktop { position: relative; width: 100vw; height: 100vh; background-size: cover; background-position: center; transition: background 0.5s; }
        #matrixCanvas { position: absolute; top: 0; left: 0; opacity: 0.1; z-index: 0; pointer-events: none; }

        /* Taskbar */
        .taskbar {
            position: absolute; top: 0; left: 0; width: 100%; height: 45px;
            background: rgba(8,8,8,0.98); border-bottom: 1px solid #333;
            display: flex; align-items: center; justify-content: space-between; padding: 0 20px; z-index: 100;
        }
        .start-btn { font-weight: bold; font-size: 16px; display: flex; align-items: center; gap:10px; cursor: pointer; }
        .sys-tray { font-size: 12px; display: flex; gap: 15px; align-items: center; }
        
        /* Audio Visualizer */
        .visualizer-bars { display: flex; gap: 2px; align-items: flex-end; height: 20px; }
        .v-bar { width: 3px; background: var(--main-neon); animation: bounce 0.5s infinite; }
        @keyframes bounce { 0%, 100% {height: 5px} 50% {height: 15px} }

        /* Icons */
        .desktop-icons { position: absolute; top: 70px; left: 30px; z-index: 10; display: flex; flex-direction: column; gap: 25px; }
        .icon { width: 90px; text-align: center; cursor: pointer; transition: 0.2s; opacity: 0.8; }
        .icon:hover { opacity: 1; transform: scale(1.1); text-shadow: 0 0 10px var(--main-neon); }
        .icon i { font-size: 32px; margin-bottom: 8px; color: #eee; display: block; }
        .icon span { font-size: 11px; background: rgba(0,0,0,0.6); padding: 3px 6px; border-radius: 4px; font-family: var(--font-text); }

        /* Windows */
        .window {
            position: absolute; width: 600px; min-height: 300px;
            background: var(--win-bg); border: 1px solid var(--main-neon);
            box-shadow: 0 10px 30px rgba(0,0,0,0.8);
            display: none; flex-direction: column; z-index: 50;
            border-radius: 6px; overflow: hidden;
        }
        .win-header {
            padding: 8px 15px; background: rgba(255,255,255,0.03);
            border-bottom: 1px solid #333; cursor: grab;
            display: flex; justify-content: space-between; align-items: center;
        }
        .win-title { font-weight: bold; font-size: 12px; text-transform: uppercase; display: flex; align-items: center; gap: 10px; }
        .btn-close { cursor: pointer; font-size: 16px; color: #666; transition: 0.2s; }
        .btn-close:hover { color: var(--alert); transform: rotate(90deg); }
        .win-body { flex: 1; overflow-y: auto; max-height: 600px; color: #ccc; font-size: 13px; position: relative; }

        /* Components */
        .btn-action { 
            background: rgba(255,255,255,0.05); border: 1px solid var(--main-neon); color: var(--main-neon); 
            padding: 8px 15px; cursor: pointer; font-family: var(--font-code); font-size: 11px; transition: 0.3s;
        }
        .btn-action:hover { background: var(--main-neon); color: #000; }
        
        input, textarea { background: #050505; border: 1px solid #333; color: #fff; padding: 8px; font-family: var(--font-code); width: 100%; }

        /* Code Editor */
        #code-editor { width: 100%; height: 300px; background: #111; border: none; color: #ddd; padding: 10px; font-size: 13px; line-height: 1.5; resize: none; }
        .ide-toolbar { display: flex; gap: 10px; padding: 10px; background: #151515; border-top: 1px solid #333; }

        /* Settings */
        .setting-row { padding: 15px; border-bottom: 1px solid #333; display: flex; justify-content: space-between; align-items: center; }
        .color-circle { width: 25px; height: 25px; border-radius: 50%; cursor: pointer; border: 2px solid #333; display: inline-block; margin-left: 5px; }

        /* Terminal */
        #terminal-body { background: #080808; padding: 10px; font-family: var(--font-code); height: 100%; }
        .prompt { color: var(--main-neon); margin-right: 5px; }

        /* Notifications */
        #notify-area { position: fixed; bottom: 20px; right: 20px; z-index: 10000; display: flex; flex-direction: column; gap: 10px; }
        .toast { 
            background: #111; border-left: 3px solid var(--main-neon); padding: 12px 20px; 
            color: #fff; font-size: 12px; box-shadow: 0 5px 15px rgba(0,0,0,0.5); 
            animation: slideIn 0.3s ease-out; font-family: var(--font-text); 
        }
        @keyframes slideIn { from {transform: translateX(100%)} to {transform: translateX(0)} }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-thumb { background: var(--main-neon); }
        ::-webkit-scrollbar-track { background: #111; }
    </style>
</head>
<body>
    <div class="scanlines"></div>

    <div id="desktop">
        <canvas id="matrixCanvas"></canvas>

        <div class="taskbar">
            <div class="start-btn" onclick="toggleStartMenu()"><i class="fas fa-layer-group"></i> JKA5_OS v7.0</div>
            
            <div class="visualizer-bars" id="visualizer" style="opacity:0">
                <div class="v-bar" style="animation-duration:0.4s"></div>
                <div class="v-bar" style="animation-duration:0.6s"></div>
                <div class="v-bar" style="animation-duration:0.3s"></div>
                <div class="v-bar" style="animation-duration:0.5s"></div>
                <div class="v-bar" style="animation-duration:0.7s"></div>
            </div>

            <div class="sys-tray">
                <i class="fas fa-wifi" style="color:var(--main-neon)"></i>
                <i class="fas fa-volume-up" onclick="toggleMusic()" style="cursor:pointer"></i>
                <span style="border-left:1px solid #333; padding-left:15px;" id="clock">00:00</span>
            </div>
        </div>

        <div class="desktop-icons">
            <div class="icon" onclick="openWindow('win-term')">
                <i class="fas fa-terminal"></i>
                <span>Terminal</span>
            </div>
            <div class="icon" onclick="openWindow('win-ide')">
                <i class="fas fa-code"></i>
                <span>JKA5 IDE</span>
            </div>
            <div class="icon" onclick="openWindow('win-net')">
                <i class="fas fa-network-wired"></i>
                <span>Net Scanner</span>
            </div>
            <div class="icon" onclick="openWindow('win-settings')">
                <i class="fas fa-cogs"></i>
                <span>Settings</span>
            </div>
            <div class="icon" onclick="openWindow('win-browser')">
                <i class="fas fa-globe"></i>
                <span>Browser</span>
            </div>
        </div>

        <div id="win-term" class="window" style="top: 80px; left: 150px; width: 700px; height: 450px;">
            <div class="win-header">
                <span class="win-title"><i class="fas fa-terminal"></i> ROOT@JKA5:~</span>
                <span class="btn-close" onclick="closeWindow('win-term')">âœ–</span>
            </div>
            <div class="win-body" id="terminal-body" onclick="document.getElementById('term-input').focus()">
                <div>JKA5 OS v7.0 [Architect Edition]</div>
                <div>* Persistent Storage: <span style="color:var(--main-neon)">ENABLED</span></div>
                <div>Type <span style="color:var(--neon-cyan)">'help'</span> for commands.</div>
                <br>
                <div id="term-output"></div>
                <div style="display:flex">
                    <span class="prompt" id="prompt-text">root@jka5:~#</span>
                    <input type="text" id="term-input" style="background:transparent; border:none; color:var(--main-neon); flex:1; font-weight:bold;" autofocus spellcheck="false">
                </div>
            </div>
        </div>

        <div id="win-ide" class="window" style="top: 100px; left: 250px; width: 600px;">
            <div class="win-header">
                <span class="win-title"><i class="fas fa-code"></i> JKA5 SCRIPT EDITOR (JS)</span>
                <span class="btn-close" onclick="closeWindow('win-ide')">âœ–</span>
            </div>
            <div class="win-body">
                <textarea id="code-editor" spellcheck="false">// Write JavaScript code here
// Example: alert('Hacked!');
console.log("JKA5 Script Running...");</textarea>
                <div class="ide-toolbar">
                    <button class="btn-action" onclick="runCode()"><i class="fas fa-play"></i> RUN SCRIPT</button>
                    <button class="btn-action" onclick="saveScript()"><i class="fas fa-save"></i> SAVE</button>
                    <span style="font-size:10px; color:#666; align-self:center; margin-left:auto;">JS Runtime v8.0</span>
                </div>
            </div>
        </div>

        <div id="win-net" class="window" style="top: 150px; left: 400px; width: 500px;">
            <div class="win-header">
                <span class="win-title"><i class="fas fa-network-wired"></i> IP / DOMAIN INTEL</span>
                <span class="btn-close" onclick="closeWindow('win-net')">âœ–</span>
            </div>
            <div class="win-body" style="padding:20px;">
                <label style="font-size:12px; color:var(--neon-cyan)">TARGET IP OR DOMAIN:</label>
                <div style="display:flex; gap:10px; margin-top:5px;">
                    <input type="text" id="net-target" placeholder="8.8.8.8">
                    <button class="btn-action" onclick="scanNetwork()">SCAN</button>
                </div>
                <hr style="border:0; border-top:1px solid #333; margin:20px 0;">
                <div id="net-result" style="font-size:12px; line-height:1.6; color:#ccc; white-space:pre-wrap;">
                    Waiting for input...
                </div>
            </div>
        </div>

        <div id="win-settings" class="window" style="top: 200px; left: 500px; width: 400px;">
            <div class="win-header">
                <span class="win-title"><i class="fas fa-cogs"></i> SYSTEM PREFERENCES</span>
                <span class="btn-close" onclick="closeWindow('win-settings')">âœ–</span>
            </div>
            <div class="win-body">
                <div class="setting-row">
                    <span>Theme Color</span>
                    <div>
                        <div class="color-circle" style="background:#00ff41" onclick="setTheme('#00ff41')"></div>
                        <div class="color-circle" style="background:#00f3ff" onclick="setTheme('#00f3ff')"></div>
                        <div class="color-circle" style="background:#bc13fe" onclick="setTheme('#bc13fe')"></div>
                        <div class="color-circle" style="background:#ff003c" onclick="setTheme('#ff003c')"></div>
                    </div>
                </div>
                <div class="setting-row">
                    <span>Wallpaper</span>
                    <div>
                         <button class="btn-action" onclick="setBg('matrix')">Matrix</button>
                         <button class="btn-action" onclick="setBg('black')">Black</button>
                    </div>
                </div>
                <div class="setting-row">
                    <span>Data Management</span>
                    <button class="btn-action" onclick="resetSystem()" style="border-color:var(--alert); color:var(--alert)">FACTORY RESET</button>
                </div>
            </div>
        </div>

         <div id="win-browser" class="window" style="top: 100px; left: 250px; width: 700px; height: 400px;">
            <div class="win-header">
               <span class="win-title"><i class="fas fa-globe"></i> JKA5 BROWSER</span>
               <span class="btn-close" onclick="closeWindow('win-browser')">âœ–</span>
           </div>
           <div class="win-body" style="padding:0;">
               <div style="padding:10px; background:#222; border-bottom:1px solid #444;">
                   <span style="color:#888">ðŸ”’ https://jka5.xyz/news</span>
               </div>
               <div style="padding:20px;">
                   <h3 style="color:var(--neon-cyan)">LATEST INTEL</h3>
                   <div id="browser-content">Loading feed...</div>
               </div>
           </div>
       </div>

    </div>

    <div id="notify-area"></div>

    <audio id="bg-audio" loop>
        <source src="https://upload.wikimedia.org/wikipedia/commons/c/c8/Techno_loop.ogg" type="audio/ogg">
    </audio>

    <script>
        // ================= 1. PERSISTENCE LAYER (THE ARCHITECT) =================
        // Ù‡Ø°Ø§ Ù‡Ùˆ Ø§Ù„Ø¹Ù‚Ù„ Ø§Ù„Ø°ÙŠ ÙŠØ­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ
        const DB_KEY = 'jka5_os_data_v7';
        
        let systemState = {
            theme: '#00ff41',
            bgMode: 'matrix',
            savedScript: '// Write JavaScript code here\nconsole.log("Hello JKA5");',
            files: {
                "notes.txt": "Remember to check logs.",
                "target.ip": "192.168.1.55"
            }
        };

        function loadState() {
            const saved = localStorage.getItem(DB_KEY);
            if(saved) {
                systemState = JSON.parse(saved);
                // Apply loaded settings
                setTheme(systemState.theme, false);
                setBg(systemState.bgMode, false);
                document.getElementById('code-editor').value = systemState.savedScript;
                notify("System State Restored", "success");
            }
        }

        function saveState() {
            localStorage.setItem(DB_KEY, JSON.stringify(systemState));
            // notify("System Saved", "info"); // Ø­ÙØ¸ ØµØ§Ù…Øª
        }

        function resetSystem() {
            if(confirm("Are you sure? This will wipe all saved data.")) {
                localStorage.removeItem(DB_KEY);
                location.reload();
            }
        }

        // ================= 2. SYSTEM CORE =================
        function initOS() {
            loadState(); // Load saved data first
            updateClock();
            startMatrix();
            document.querySelectorAll('.window').forEach(dragElement);
            loadNews();
            
            // Focus Terminal
            setTimeout(()=>openWindow('win-term'), 500);
        }
        window.onload = initOS;

        function updateClock() {
            const now = new Date();
            document.getElementById('clock').innerText = now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
            setTimeout(updateClock, 1000);
        }

        // Theme Engine
        function setTheme(color, save=true) {
            document.documentElement.style.setProperty('--main-neon', color);
            startMatrix(color);
            if(save) {
                systemState.theme = color;
                saveState();
                notify("Theme Saved", "success");
            }
        }

        // Wallpaper Engine
        function setBg(mode, save=true) {
            const desk = document.getElementById('desktop');
            const matrix = document.getElementById('matrixCanvas');
            
            if(mode === 'matrix') {
                desk.style.background = 'radial-gradient(circle at center, #0a0a0a 0%, #000 100%)';
                matrix.style.display = 'block';
            } else {
                desk.style.background = '#000';
                matrix.style.display = 'none';
            }
            
            if(save) {
                systemState.bgMode = mode;
                saveState();
                notify("Wallpaper Updated", "info");
            }
        }

        // ================= 3. WINDOW MANAGER & UTILS =================
        let zIndex = 100;
        function openWindow(id) {
            const win = document.getElementById(id);
            win.style.display = 'flex';
            zIndex++; win.style.zIndex = zIndex;
        }
        function closeWindow(id) { document.getElementById(id).style.display = 'none'; }

        function dragElement(elmnt) {
            let pos1=0, pos2=0, pos3=0, pos4=0;
            const header = elmnt.querySelector('.win-header');
            if(header) header.onmousedown = dragMouseDown;
            function dragMouseDown(e) {
                e.preventDefault(); pos3=e.clientX; pos4=e.clientY;
                document.onmouseup=closeDragElement; document.onmousemove=elementDrag;
                zIndex++; elmnt.style.zIndex=zIndex;
            }
            function elementDrag(e) {
                e.preventDefault(); pos1=pos3-e.clientX; pos2=pos4-e.clientY;
                pos3=e.clientX; pos4=e.clientY;
                elmnt.style.top=(elmnt.offsetTop-pos2)+"px"; elmnt.style.left=(elmnt.offsetLeft-pos1)+"px";
            }
            function closeDragElement() { document.onmouseup=null; document.onmousemove=null; }
        }

        function notify(msg, type='info') {
            const area = document.getElementById('notify-area');
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.style.borderLeftColor = type === 'success' ? systemState.theme : '#fff';
            toast.innerHTML = `<i class="fas fa-${type==='success'?'check':'info'}-circle"></i> ${msg}`;
            area.appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
        }

        // ================= 4. TERMINAL (WITH FILE SYSTEM) =================
        const termInput = document.getElementById('term-input');
        const termOutput = document.getElementById('term-output');

        termInput.addEventListener('keypress', function(e) {
            if(e.key === 'Enter') {
                const args = this.value.trim().split(" ");
                const cmd = args[0].toLowerCase();
                printTerm(`root@jka5:~# ${this.value}`);

                if(cmd === 'help') printTerm("Commands: ls, cat, touch, clear, date, theme");
                else if(cmd === 'clear') termOutput.innerHTML = "";
                else if(cmd === 'ls') {
                    let out = "";
                    for(let f in systemState.files) out += `<span style="color:#ccc">${f}</span>  `;
                    printTerm(out || "(empty)");
                }
                else if(cmd === 'touch') {
                    if(args[1]) {
                        systemState.files[args[1]] = "New file content.";
                        saveState();
                        printTerm(`File '${args[1]}' created.`);
                    } else printTerm("Usage: touch <filename>", "error");
                }
                else if(cmd === 'cat') {
                    if(systemState.files[args[1]]) printTerm(systemState.files[args[1]]);
                    else printTerm("File not found.", "error");
                }
                else printTerm("Command not found.", "error");

                this.value = "";
                document.getElementById('terminal-body').scrollTop = document.getElementById('terminal-body').scrollHeight;
            }
        });

        function printTerm(txt, type="normal") {
            const d = document.createElement('div');
            d.innerHTML = txt;
            if(type==='error') d.style.color = 'var(--alert)';
            termOutput.appendChild(d);
        }

        // ================= 5. IDE (CODE EDITOR) =================
        function runCode() {
            const code = document.getElementById('code-editor').value;
            try {
                // Dangerous in real world, but safe-ish for client-side sandbox
                eval(code); 
                notify("Script Executed", "success");
            } catch(e) {
                alert("Error: " + e.message);
            }
        }
        function saveScript() {
            systemState.savedScript = document.getElementById('code-editor').value;
            saveState();
            notify("Script Saved to Storage", "success");
        }

        // ================= 6. NETWORK SCANNER (API) =================
        async function scanNetwork() {
            const target = document.getElementById('net-target').value;
            const resBox = document.getElementById('net-result');
            resBox.innerHTML = "Scanning " + target + "...<br>[*] Initiating handshake...";
            
            try {
                // Using a free API (ipapi.co)
                const response = await fetch(`https://ipapi.co/${target}/json/`);
                const data = await response.json();
                
                if(data.error) throw new Error("Invalid IP/Target");

                resBox.innerHTML = `
<span style="color:var(--main-neon)">[+] SCAN COMPLETE</span>
-----------------------------
IP: ${data.ip}
City: ${data.city}
Region: ${data.region}
Country: ${data.country_name}
ISP: ${data.org}
Timezone: ${data.timezone}
-----------------------------
                `;
                notify("Scan Successful", "success");
            } catch(e) {
                resBox.innerHTML = `<span style="color:var(--alert)">[-] SCAN FAILED: ${e.message}</span>`;
            }
        }

        // ================= 7. AUDIO & EXTRAS =================
        let isPlaying = false;
        function toggleMusic() {
            const audio = document.getElementById('bg-audio');
            const visualizer = document.getElementById('visualizer');
            if(isPlaying) {
                audio.pause();
                visualizer.style.opacity = 0;
            } else {
                audio.play();
                visualizer.style.opacity = 1;
            }
            isPlaying = !isPlaying;
        }

        function loadNews() {
            document.getElementById('browser-content').innerHTML = `
                <div style="margin-bottom:10px"><b>Chrome Zero-Day (CVE-2025-101)</b><br><small>Critical update released.</small></div>
                <div style="margin-bottom:10px"><b>JKA5 Updates</b><br><small>Persistence layer added.</small></div>
            `;
        }

        // Matrix
        function startMatrix(color='#00ff41') {
            const c = document.getElementById("matrixCanvas");
            const ctx = c.getContext("2d");
            c.width = window.innerWidth; c.height = window.innerHeight;
            const chars = "01"; const drops = Array(Math.floor(c.width/20)).fill(1);
            setInterval(()=>{
                ctx.fillStyle="rgba(0,0,0,0.05)"; ctx.fillRect(0,0,c.width,c.height);
                ctx.fillStyle=color; ctx.font="15px monospace";
                drops.forEach((y,i)=>{
                    ctx.fillText(chars[Math.floor(Math.random()*2)],i*20,y*20);
                    if(y*20>c.height && Math.random()>0.98) drops[i]=0;
                    drops[i]++;
                });
            }, 50);
        }
    </script>
</body>
</html>
